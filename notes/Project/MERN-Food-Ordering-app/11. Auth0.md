
**https://auth0.com 

![[Pasted image 20240402155328.png]]
![[Pasted image 20240402155440.png]]

## #1 Créer une Application sur Auth0

![[Pasted image 20240402171209.png]]

![[Pasted image 20240402171401.png]]
![[Pasted image 20240402171443.png]]

Onglet `Settings` > `Application URLs`

![[Pasted image 20240402171751.png]]

Ajouter les urls de call back. Ex : http://localhost:5173
- Allowed Callback URLs
- Allowed Logout URLs
- Allowed Web Origins

## #2 Installer le package Auth0 dans le dossier /frontEnd

**https://auth0.com/docs/quickstart/spa/react/01-login#install-the-auth0-react-sdk

```bash
npm install @auth0/auth0-react
```

- **Créer un nouveau dossier `auth` dans `src`**
- **Créer un nouveau composant `Auth0ProviderWithNavigate.tsx` dans ce dossier**

> Créer le code que va utiliser le SDK pour se connecter sur Auth0
> Dans le fichier créer un Component with Props (rfcp)
> Definir les props qui va prendre : children comme type : React.ReactNode

```tsx
import { AppState, Auth0Provider, User } from "@auth0/auth0-react";

type Props = {
  children: React.ReactNode;
}

const Auth0ProviderWithNavigate = ({ children }: Props) => {
    const domain = import.meta.env.VITE_AUTH0_DOMAIN;
    const clientId = import.meta.env.VITE_AUTH0_CLIENT_ID;
    const redirectUrl = import.meta.env.VITE_AUTH0_CALLBACK_URL;

    if(!domain || !clientID || !redirectUrl) {
        throw new Error("unable to init auth");
    }


    const onRedirectCallback = (appState?: AppState, user?: User) => {
        console.log("USER", user);
    }

    return (
        <Auth0Provider 
            domain={domain} 
            clientId={clientId} 
            authorizationParams={{
                redirect_uri: redirectUrl,
            }}
            onRedirectCallback={onRedirectCallback}
        >
            {children}
        </Auth0Provider>
    )
};

export default Auth0ProviderWithNavigate;
```

**Créer un fichier `.env` dans le dossier frontEnd**

> Définir toutes les variables d'environnements que l'on a indiqué dans le Auth

```tsx
const domain = import.meta.env.VITE_AUTH0_DOMAIN;
const clientId = import.meta.env.VITE_AUTH0_CLIENT_ID;
const redirectUrl = import.meta.env.VITE_AUTH0_CALLBACK_URL;
```

> Rechercher les bonnes clés sur le site Auth0 dans l'application créée 

`.env`
```
VITE_AUTH0_DOMAIN=dev-yz1q78yp6war6lii.eu.auth0.com
VITE_AUTH0_CLIENT_ID=bpTQns5BpV8TNQnOBCQsytXBqG7fCrEc
VITE_AUTH0_CALLBACK_URL=http://localhost:5173
```

**Editer les routes dans le fichier `main.tsx`**
> Cela permettra de bloquer la route si l'user n'est pas connecté

```tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import './global.css'
import { BrowserRouter as Router } from "react-router-dom";
import AppRoutes from './AppRoutes';
import Auth0ProviderWithNavigate from './auth/Auth0ProviderWithNavigate';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Router>
      // On ajoute ici le composant auth0 pour englober AppRoutes
      <Auth0ProviderWithNavigate>
        <AppRoutes />
      </Auth0ProviderWithNavigate>
    </Router>
  </React.StrictMode>
)
```

**Créer une const pour le login dans le fichier `MainNav.tsx`**

> Cette const devra utiliser la fonction useAuth0()

```tsx
import { useAuth0 } from "@auth0/auth0-react";
import { Button } from "./ui/button";

const MainNav = () => {
    const { loginWithRedirect } = useAuth0();
    return (
        <Button 
            variant="ghost" 
            className="font-bold hover:text-orange-500 hover:bg-white"
            onClick={ async () => await loginWithRedirect() }
        >
            Se connecter
        </Button>
    )
}

export default MainNav;
```

**Tester** 
![[Pasted image 20240402212425.png]]

